# Deployment Guide - Render.com

## Automatic Deployment Setup

This application is configured for **automatic deployment** on Render.com. Every push to the `main` branch on GitHub will trigger an automatic build and deploy.

### Prerequisites

1. **GitHub Repository**: App is connected to `Dali15/App-for-AI-club`
2. **Render Service**: Web service created at `ai-club-ssnk.onrender.com`
3. **PostgreSQL Database**: Auto-provisioned by Render

---

## Environment Variables (Must be set in Render Dashboard)

Set these in **Render Dashboard → Environment → Environment Variables**:

```
DEBUG=False
SECRET_KEY=<your-secret-key>
ALLOWED_HOSTS=ai-club-ssnk.onrender.com
DATABASE_URL=<auto-generated>
GEMINI_API_KEY=<your-api-key-if-using>
USE_AI_API=False
```

---

## Build Process

### Build Command (Render Dashboard)
```bash
pip install -r requirements.txt && python manage.py migrate --noinput && python manage.py collectstatic --noinput --clear
```

### Start Command (Render Dashboard)
```bash
bash start.sh
```

---

## Deployment Files

### `Procfile`
- Defines release and web process commands
- Release process: runs migrations & collects static files
- Web process: starts the app via `start.sh`

### `start.sh`
- Applies migrations
- Creates superuser (if configured)
- Collects static files
- Starts Gunicorn server
- Syncs role permissions

### `runtime.txt`
- Specifies Python version: `3.11.8`

### `requirements.txt`
- All Python dependencies for production

---

## How Automatic Deployment Works

1. **Push Code to GitHub**
   ```bash
   git push origin main
   ```

2. **GitHub Webhook Triggers Render Build**
   - Render detects push to `main` branch
   - Automatically starts build process

3. **Render Build Steps**
   - Install dependencies: `pip install -r requirements.txt`
   - Run migrations: `python manage.py migrate --noinput`
   - Collect static files: `python manage.py collectstatic --noinput --clear`
   - Start web server: `bash start.sh`

4. **Application Live**
   - App available at `https://ai-club-ssnk.onrender.com`

---

## Manual Deployment (if needed)

### Option 1: Trigger via Render Dashboard
1. Go to Render Dashboard
2. Select your service
3. Click **"Deploy Latest Commit"**

### Option 2: Push to GitHub
```bash
git push origin main
```

### Option 3: Trigger via Render API (script)
You can trigger a deploy from your machine using Render's API. Create an API key in Render (Service -> API Keys) and set two env vars locally:

```bash
export RENDER_API_KEY="<your_render_api_key>"
export RENDER_SERVICE_ID="<your_render_service_id>"
```

Then run the included script:

```bash
./render_trigger.sh
```

The script will POST to Render's deploy endpoint to start a manual deploy and clear the service cache.

---

## Troubleshooting

### Deployment Not Triggering
1. Verify webhook is connected in Render dashboard
2. Check that you're pushing to `main` branch
3. Verify GitHub repository is correctly linked

### Build Failures
1. Check Render build logs in dashboard
2. Verify environment variables are set
3. Check `requirements.txt` has all dependencies
4. Ensure `start.sh` has correct permissions

### Application Not Starting
1. Check Render logs for errors
2. Verify `ALLOWED_HOSTS` includes your Render domain
3. Ensure `DEBUG=False` in production
4. Check database connection with `DATABASE_URL`

### Static Files Not Loading
1. Static files are collected in `STATIC_ROOT = BASE_DIR / 'staticfiles'`
2. WhiteNoise middleware handles serving: `'whitenoise.middleware.WhiteNoiseMiddleware'`
3. Run `collectstatic` on Render if needed

---

## Git Workflow

```bash
# Make changes locally
git add .
git commit -m "Your commit message"

# Push to GitHub (triggers automatic deploy)
git push origin main

# Monitor deployment in Render dashboard
```

---

## Key Configuration Files

| File | Purpose |
|------|---------|
| `Procfile` | Defines release and web process commands |
| `start.sh` | Startup script for application |
| `runtime.txt` | Python version specification |
| `requirements.txt` | Python dependencies |
| `ai_club/settings.py` | Django main settings |
| `ai_club/settings_production.py` | Production-specific overrides |

---

## Database Management

### Automatic Migrations
- Run via Render release process (before web process starts)
- Command: `python manage.py migrate --noinput`

### Create Superuser
- Automatically created via `create_superuser.py` during startup
- Uses environment variables (set in Render dashboard)

### Backup Database
1. In Render dashboard: Data → Backups → Create Manual Backup
2. Or connect PostgreSQL client directly to `DATABASE_URL`

---

## Security Notes

- ✅ `DEBUG=False` in production
- ✅ `SECRET_KEY` should be strong and unique
- ✅ `ALLOWED_HOSTS` configured for `ai-club-ssnk.onrender.com`
- ✅ HTTPS enforced: `SECURE_SSL_REDIRECT = not DEBUG`
- ✅ Session cookies secure: `SESSION_COOKIE_SECURE = not DEBUG`
- ✅ CSRF cookies secure: `CSRF_COOKIE_SECURE = not DEBUG`

---

## Next Steps

1. **Verify Deployment**
   - Visit `https://ai-club-ssnk.onrender.com`
   - Check that logo displays correctly
   - Test login functionality

2. **Monitor Application**
   - Check Render dashboard logs regularly
   - Set up email alerts for build/deployment failures

3. **Update Content**
   - All code changes pushed to `main` automatically deploy
   - No manual deployment steps required

---

**Last Updated**: February 3, 2026
