{% extends "base.html" %}

{% block title %}Dashboard - AI Club{% endblock %}

{% block content %}
<h1 class="page-title">
    <i class="fas fa-chart-line"></i> Dashboard
</h1>

<!-- Stats Cards -->
{% if user.is_bureau %}
<div class="row mb-4">
    <div class="col-md-4 mb-3">
        <div class="card border-left-primary">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <p class="text-muted mb-1">Total Members</p>
                        <h3 class="mb-0" style="color: #1e88e5; font-weight: 700;">{{ total_members }}</h3>
                    </div>
                    <i class="fas fa-users fa-3x" style="color: #e3f2fd;"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-3">
        <div class="card border-left-success">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <p class="text-muted mb-1">Active Events</p>
                        <h3 class="mb-0" style="color: #43a047; font-weight: 700;">{{ total_events }}</h3>
                    </div>
                    <i class="fas fa-calendar-alt fa-3x" style="color: #e8f5e9;"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-3">
        <div class="card border-left-warning">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <p class="text-muted mb-1">Total Registrations</p>
                        <h3 class="mb-0" style="color: #fb8c00; font-weight: 700;">{{ total_registrations }}</h3>
                    </div>
                    <i class="fas fa-check-circle fa-3x" style="color: #fff3e0;"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .border-left-primary {
        border-left: 4px solid #1e88e5 !important;
    }

    .border-left-success {
        border-left: 4px solid #43a047 !important;
    }

    .border-left-warning {
        border-left: 4px solid #fb8c00 !important;
    }
</style>

<!-- Quick Actions -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-bolt"></i> Quick Actions</h5>
            </div>
            <div class="card-body">
                <div class="d-flex gap-2 flex-wrap">
                    <a href="{% url 'event_list' %}" class="btn btn-primary">
                        <i class="fas fa-calendar"></i> View Events
                    </a>
                    <a href="{% url 'announcement_list' %}" class="btn btn-success">
                        <i class="fas fa-bell"></i> View Announcements
                    </a>
                    <a href="{% url 'assistant:chat' %}" class="btn btn-info">
                        <i class="fas fa-comments"></i> Chat Personnel
                    </a>
                    {% if user.role == 'owner' or user.role == 'president' %}
                    <a href="{% url 'activity_history' %}" class="btn btn-info">
                        <i class="fas fa-history"></i> View History
                    </a>
                    {% endif %}
                    {% if perms.accounts.change_user %}
                    <!-- Replaced by specific Manage Roles on Member Profile -->
                    {% endif %}

                    {% if perms.events.add_event %}
                    <a href="{% url 'create_event' %}" class="btn btn-info">
                        <i class="fas fa-plus"></i> Create Event
                    </a>
                    {% endif %}

                    {% if perms.announcements.add_announcement %}
                    <a href="{% url 'create_announcement' %}" class="btn btn-warning">
                        <i class="fas fa-plus"></i> Create Announcement
                    </a>
                    {% endif %}

                    {% if perms.accounts.view_user %}
                    <a href="{% url 'member_list' %}" class="btn btn-secondary">
                        <i class="fas fa-users"></i> View Members
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- User Info Card -->
<div class="row">
    <div class="col-md-6 mb-3">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-user-circle"></i> Your Profile</h5>
            </div>
            <div class="card-body">
                <table class="table mb-0">
                    <tr>
                        <td><strong>Username:</strong></td>
                        <td>{{ user.username }}</td>
                    </tr>
                    <tr>
                        <td><strong>Email:</strong></td>
                        <td>{{ user.email|default:"Not provided" }}</td>
                    </tr>
                    <tr>
                        <td><strong>Role:</strong></td>
                        <td>
                            <span class="badge bg-primary">{{ user.get_role_display }}</span>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Status:</strong></td>
                        <td>
                            {% if user.is_active %}
                            <span class="badge bg-success"><i class="fas fa-check"></i> Active</span>
                            {% else %}
                            <span class="badge bg-danger"><i class="fas fa-times"></i> Inactive</span>
                            {% endif %}
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <div class="col-md-6 mb-3">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-shield-alt"></i> Permissions</h5>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    {% if user.is_superuser %} <!-- Owner/President -->
                    <div class="list-group-item">
                        <i class="fas fa-crown text-warning"></i> <strong>Full Admin Access</strong>
                    </div>
                    {% endif %}

                    {% if perms.accounts.view_user %}
                    <div class="list-group-item">
                        <i class="fas fa-check text-success"></i> View Members
                    </div>
                    {% endif %}

                    {% if perms.accounts.change_user %}
                    <div class="list-group-item">
                        <i class="fas fa-check text-success"></i> Manage Members (Edit)
                    </div>
                    {% endif %}

                    {% if perms.events.add_event %}
                    <div class="list-group-item">
                        <i class="fas fa-check text-success"></i> Create Events
                    </div>
                    {% endif %}

                    {% if perms.events.change_event %}
                    <div class="list-group-item">
                        <i class="fas fa-check text-success"></i> Manage Events
                    </div>
                    {% endif %}

                    {% if perms.announcements.add_announcement %}
                    <div class="list-group-item">
                        <i class="fas fa-check text-success"></i> Create Announcements
                    </div>
                    {% endif %}

                    {% if perms.projects.add_project %}
                    <div class="list-group-item">
                        <i class="fas fa-check text-success"></i> Create Projects
                    </div>
                    {% endif %}

                    <div class="list-group-item">
                        <i class="fas fa-check text-success"></i> View & Register Events
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% else %}
<!-- Welcome Message for Regular Members -->
<div class="card mb-4">
    <div class="card-body text-center py-5">
        <h4 class="mb-2">Welcome, {{ user.first_name|default:user.username }}!</h4>
        <p class="text-muted mb-0">Explore upcoming events and announcements below.</p>
    </div>
</div>

<!-- Featured Events -->
<div class="row">
    <div class="col-12">
        <h5 class="mb-3"><i class="fas fa-calendar"></i> Upcoming Events</h5>
        <a href="{% url 'event_list' %}" class="btn btn-primary btn-sm mb-3">View All Events</a>
    </div>
</div>

<!-- Featured Announcements -->
<div class="row mt-4">
    <div class="col-12">
        <h5 class="mb-3"><i class="fas fa-bell"></i> Latest Announcements</h5>
        <a href="{% url 'announcement_list' %}" class="btn btn-success btn-sm mb-3">View All Announcements</a>
    </div>
</div>
{% endif %}

{% endblock %}